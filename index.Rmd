---
title: "OMOP2OBO Dashboard"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    source_code: embed
    orientation: columns
    vertical_layout: fill
    social: menu
---

```{r setup, include=FALSE}
library(flexdashboard)

#------------------ Parameters ------------------
# set value board colors
# https://www.w3.org/TR/css-color-3/#svg-color
cond_color <- "forestgreen"
drug_color <- "purple"
lab_color <- "#1f77b4"

# placeholder for value board counts
cond_count <- 97325
drug_count<- 10245
lab_count <- 4558

# timestamp for tables
run_time <- format(Sys.time(), "%a %b %d %X %Y")

# function for data table embedded bar charts
bar_chart <- function(label, width = "100%", height = "14px", fill = "#00bfc4", background = NULL) {
  bar <- htmltools::div(style = list(background = fill, width = width, height = height))
  chart <- htmltools::div(style = list(flexGrow = 1, marginLeft = "6px", background = background), bar)
  htmltools::div(style = list(display = "flex", alignItems = "center"), label, chart)
}


#------------------ TABLES ------------------
# create fake table data
state_names <- rownames(USArrests)
data <- USArrests 
data$States <- rownames(data)
rownames(data) <- NULL

```


Mapping Summary {data-icon="fa-map"}
===================================== 

Column { data-width=150 }
-----------------------------------------------------------------------

### conditions {.value-box}
```{r}
valueBox(value = paste(format(cond_count, big.mark = ","), "", sep = " "), 
         caption = "Conditions", 
         icon = "fas fa-procedures", 
         color = cond_color)
```

### drugs {.value-box}
```{r}
valueBox(value = paste(format(drug_count, big.mark = ","), "", sep = " "), 
         caption = "Drug Ingredients", 
         icon = "fas fa-pills", 
         color = drug_color)
```

### measurements {.value-box}
```{r}
valueBox(value = paste(format(lab_count, big.mark = ","), "", sep = " "), 
         caption = "Measurements", 
         icon = "fas gfa-vials", 
         color = lab_color)
```


Column {data-width=350}
-----------------------------------------------------------------------

### Condition Mappings

```{r}
library(plotly)
library(dplyr)

fig <- ggplot2::diamonds
fig <- fig %>% count(cut, clarity)
fig <- fig %>% plot_ly(x = ~cut, y = ~n, color = ~clarity)
fig <- fig %>% layout(yaxis = list(title = 'Count'),
                      xaxis = list(title = 'Cut'),
                      title = "Count of Diamonds by Cut and Clarity"
)

fig
```


Column {data-width=350}
-----------------------------------------------------------------------

### Drug Ingredient Mappings

```{r}
library(plotly)

Animals <- c("giraffes", "orangutans", "monkeys")
SF_Zoo <- c(20, 14, 23)
LA_Zoo <- c(12, 18, 29)
data2 <- data.frame(Animals, SF_Zoo, LA_Zoo)

fig <- plot_ly(data2, x = ~Animals, y = ~SF_Zoo, type = 'bar', name = 'SF Zoo')
fig <- fig %>% add_trace(y = ~LA_Zoo, name = 'LA Zoo')
fig <- fig %>% layout(yaxis = list(title = 'Count'),
                      title = "Count of Animals by Zoo",
                      barmode = 'group')

fig
```


Column {data-width=350}
-----------------------------------------------------------------------

### Measurement Mappings

```{r}
library(plotly)

x <- c(1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012)
roW <- c(219, 146, 112, 127, 124, 180, 236, 207, 236, 263, 350, 430, 474, 526, 488, 537, 500, 439)
China <- c(16, 13, 10, 11, 28, 37, 43, 55, 56, 88, 105, 156, 270, 299, 340, 403, 549, 499)
data3 <- data.frame(x, roW, China)

fig <- plot_ly(data3, x = ~x, y = ~roW, type = 'bar', name = 'Rest of the World',
        marker = list(color = 'rgb(55, 83, 109)'))
fig <- fig %>% add_trace(y = ~China, name = 'China', marker = list(color = 'rgb(26, 118, 255)'))
fig <- fig %>% layout(title = 'US Export of Plastic Scrap',
         xaxis = list(
           title = "",
           tickfont = list(
             size = 14,
             color = 'rgb(107, 107, 107)')),
         yaxis = list(
           title = 'USD (millions)',
           titlefont = list(
             size = 16,
             color = 'rgb(107, 107, 107)'),
           tickfont = list(
             size = 14,
             color = 'rgb(107, 107, 107)')),
         legend = list(x = 0, y = 1, bgcolor = 'rgba(255, 255, 255, 0)', bordercolor = 'rgba(255, 255, 255, 0)'),
         barmode = 'group', bargap = 0.15)

fig
```



Data {data-icon="fa-table"}
===================================== 

### Condition Occurrence Mappings

```{r table1}

table <- reactable::reactable(
  data = data,
  pagination = FALSE,
  highlight = TRUE,
  height = 1200,
  defaultSorted = "States",
  sortable = TRUE,
  borderless = TRUE,
  defaultPageSize = nrow(data),
  columns = list(
    States = reactable::colDef(name = "States", sortable = TRUE, defaultSortOrder = "asc", align = "left"),
    Assault = reactable::colDef(name = "Assaults", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Assault), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "gold")}),
    Rape = reactable::colDef(name = "Rapes", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Rape), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "orange")}),
    Murder = reactable::colDef(name = "Murders", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Murder), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "red")})
    ))

htmltools::div(
  class = "condition-mapping-data",
  htmltools::div(class = "condition-mapping-data-header",
                 htmltools::div(
                   class = "condition-mapping-data-title",
                   "Source: OMOP2OBO v1.0 - OMOP v5.3 Condition Occurrence Mappings"),
                 paste("Last Update: ", run_time, " EST", sep = "")),
  table
)
```


### Drug Ingredient Mappings

```{r table2}

table <- reactable::reactable(
  data = data,
  pagination = FALSE,
  highlight = TRUE,
  height = 1200,
  defaultSorted = "States",
  sortable = TRUE,
  borderless = TRUE,
  defaultPageSize = nrow(data),
  columns = list(
    States = reactable::colDef(name = "States", sortable = TRUE, defaultSortOrder = "asc", align = "left"),
    Assault = reactable::colDef(name = "Assaults", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Assault), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "gold")}),
    Rape = reactable::colDef(name = "Rapes", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Rape), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "orange")}),
    Murder = reactable::colDef(name = "Murders", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Murder), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "red")})
    ))

htmltools::div(
  class = "drug-mapping-data",
  htmltools::div(class = "drug-mapping-data-header",
                 htmltools::div(
                   class = "drug-mapping-data-title",
                   "Source: OMOP2OBO v1.0 - OMOP v5.3 Drug Exposure Ingredient Mappings"),
                 paste("Last Update: ", run_time, " EST", sep = "")),
  table
)
```


### Measurement Mappings

```{r table3}

table <- reactable::reactable(
  data = data,
  pagination = FALSE,
  highlight = TRUE,
  height = 1200,
  defaultSorted = "States",
  sortable = TRUE,
  borderless = TRUE,
  defaultPageSize = nrow(data),
  columns = list(
    States = reactable::colDef(name = "States", sortable = TRUE, defaultSortOrder = "asc", align = "left"),
    Assault = reactable::colDef(name = "Assaults", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Assault), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "gold")}),
    Rape = reactable::colDef(name = "Rapes", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Rape), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "orange")}),
    Murder = reactable::colDef(name = "Murders", sortable = TRUE, align = "left",
                                cell = function(value) {
                                width <- paste0(value * 100 / max(data$Murder), "%")
                                value <- format(value, big.mark = ",")
                                bar_chart(value, width = width, fill = "red")})
    ))

htmltools::div(
  class = "lab-mapping-data",
  htmltools::div(class = "lab-mapping-data-header",
                 htmltools::div(
                   class = "lab-mapping-data-title",
                   "Source: OMOP2OBO v1.0 - OMOP v5.3 Measurement Mappings"),
                 paste("Last Update: ", run_time, " EST", sep = "")),
  table
)
```



About {data-icon="fa-address-card"}
===================================== 

**The OMOP2OBO Mapping Dashboard**

The US Wildfire Dashboard provides a live update for the ongoing wildfire in the US. This dashboard is built with R using [Rmakrdown](https://rmarkdown.rstudio.com/) and [flexdashboard](https://rmarkdown.rstudio.com/flexdashboard/) framework, and can easily reproduce by others. The code behind the dashboard available [here](https://github.com/RamiKrispin/uswildfire)


**Mapping Overview**

Add some example here of a mapping

**OMOP2OBO Users and Usecases**  


<br>
___

We’d love to hear from you! To get in touch with us, please join or start a new [discussion](https://github.com/callahantiff/OMOP2OBO_Dashboard/discussions), create an [issue](https://github.com/callahantiff/OMOP2OBO_Dashboard/issues) or send us an [email](https://mail.google.com/mail/u/0/?view=cm&fs=1&tf=1&to=callahantiff@gmail.com) 💌
